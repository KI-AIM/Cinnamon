<p>
    This page allows you to easily upload files to our system. Multiple file types are supported by the application.
</p>

<div>
    <input type="file" accept=".csv,.xlsx" #fileForm (input)="onFileInput($event)">
    <a title="Additional Settings" (click)="openDialog(fileConfigurationDialog)"
        [hidden]="!this.file" style="vertical-align: middle;">
        <mat-icon fontIcon="settings"></mat-icon>
    </a>
</div>

<div class="py-2">
    <button mat-raised-button color="primary" (click)="uploadFile()" [disabled]="!this.file">Confirm file and start configuration</button>
</div>

<h3>More Information</h3>

<p>
    <b>Upload:</b>
    <br />
    Use the 'Browse' button to open your file explorer and select the file(s) you want to
    upload. Alternatively, drag and drop your files directly into the designated area.
    <br /><br />
    <b>Supported File Types:</b>
    <br />
    Ensure your files are in a supported format. You'll be notified if
    the file type is not accepted. <br />
    Supported file types are:
</p>
<ul>
    <li>CSV Files</li>
    <li>XLSX Files</li>
    <li>FHIR Bundles</li>
</ul>
<p>
    <b>File Size Limit:</b>
    <br />
    Please note that there is a limit on the size of each file you can
    upload. Most algroithms by this application take a long time to process. To ensure that processing times
    are somewhat reasonable, we have to limit the dataset size.
    <br /><br />
    <b>Upload Progress:</b>
    <br />
    Once you've selected your file, the upload process will begin. You will see a loading screen. Before
    saving the data, the application will transform and validate it. The validation results will be shown
    after the process is finished.
    <br /><br />
    <b>Security:</b> Your files are transmitted securely using
    encryption protocols to protect your data. The data never leaves the system where the KI-AIM application
    is installed. The processed data will also only be accessable to the user that uploaded the data and
    will be deleted after the process was finished.
</p>


<ng-template #fileConfigurationDialog>
    <mat-dialog-content class="mat-typography">
        <h1>Configure the file</h1>
        <div *ngIf="this.currentFileType == 'csv'">
            <div>
                <mat-form-field class="d-block">
                    <mat-label>Column Separator</mat-label>
                    <mat-select [(ngModel)]="this.fileConfiguration.csvFileConfiguration.columnSeparator">
                        <mat-option *ngFor="let delimiter of delimiters" [value]="delimiter">
                            {{ delimiterLabels[delimiter] }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div>
                <mat-form-field class="d-block">
                    <mat-label>Line break</mat-label>
                    <mat-select [(ngModel)]="this.fileConfiguration.csvFileConfiguration.lineSeparator">
                        <mat-option *ngFor="let lineEnd of lineEndings" [value]="lineEnd">
                            {{ lineEndingLabels[lineEnd] }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div>
                <mat-form-field class="d-block">
                    <mat-label>Quote Char</mat-label>
                    <mat-select [(ngModel)]="this.fileConfiguration.csvFileConfiguration.quoteChar">
                        <mat-option *ngFor="let quoteChar of quoteChars" [value]="quoteChar">
                            {{ quoteCharLabels[quoteChar] }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <div>
                <mat-checkbox [(ngModel)]="this.fileConfiguration.csvFileConfiguration.hasHeader" color="primary">
                    Use first row as header
                </mat-checkbox>
            </div>
        </div>
        <div *ngIf="this.currentFileType == 'xlsx'">
            <div>
                <mat-checkbox [(ngModel)]="this.fileConfiguration.xlsxFileConfiguration.hasHeader" color="primary">
                    Use first row as header
                </mat-checkbox>
            </div>
        </div>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
        <button mat-raised-button mat-dialog-close color="primary">Close</button>
    </mat-dialog-actions>
</ng-template>
