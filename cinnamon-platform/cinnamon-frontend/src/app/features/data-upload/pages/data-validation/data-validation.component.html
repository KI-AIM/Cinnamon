<ng-container *ngIf="status$ | async as status">
    <ng-container *ngIf="status.mode === Mode.STANDARD">

        <mat-accordion>

            <mat-expansion-panel [disabled]="0 > currentStep" class="workstep-expansion-panel"
                                 [class.workstep-complete]="currentStep > 0 || stepsCompleted">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <app-workstep-title [stepIndex]="0">
                            View the imported dataset
                        </app-workstep-title>
                    </mat-panel-title>
                    <mat-panel-description>
                    </mat-panel-description>
                </mat-expansion-panel-header>

                <ng-template matExpansionPanelContent>

                    <div class="cinnamon-workstep-div"></div>

                    <p>
                        The transformation of the data for your configuration was successful. You can inspect the result
                        below. <br/><br/>

                        Lines that are marked in red will be removed from your dataset, as they could not be transformed with your configuration.
                        The faulty column is marked in a deeper tone of red.
                        You can filter for valid and invalid rows in the table below.
                        <br/><br/>

                        This application does not offer any mechanism to fix your data. You can however continue with the valid rows.
                        If you want to change anything, please adjust your data manually and start again.
                    </p>

                    <ng-container *ngIf="dataSetInfo$ | async as dataSetInfo">
                        <ng-container *ngIf="dataSetInfo.hasHoldOutSplit">
                            <p>
                                Because of the extended analysis, the dataset was split into two parts.
                                The first part will be anonymized and used for the synthesis.
                                The second part will not be contained in the result and instead be used to evaluate the privacy.
                                You can view the data contained in both splits by selecting the respective split in the table below.
                            </p>
                        </ng-container>
                    </ng-container>

                    <table style="font-weight: bold;">
                        <tr>
                            <td style="padding-right: 1rem;">Rows in the dataset:</td>
                            <td>{{ numberRows$ | async }}</td>
                        </tr>
                        <tr>
                            <td style="padding-right: 1rem;">Rows that will be adjusted because of conflicts with your configuration:</td>
                            <td>{{ numberInvalidRows$ | async }}</td>
                        </tr>
                    </table>

                    <div class="mt-3">
                        <app-data-table sourceDataset="validation"></app-data-table>
                    </div>

                    <app-workstep [locked]="locked" [stepIndex]="0" [valid]="true"></app-workstep>
                </ng-template>

            </mat-expansion-panel>

            <mat-expansion-panel [disabled]="1 > currentStep" class="workstep-expansion-panel"
                                 [class.workstep-complete]="currentStep > 1 || stepsCompleted">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <app-workstep-title [stepIndex]="1">
                            View statistics
                        </app-workstep-title>
                    </mat-panel-title>
                    <mat-panel-description>
                    </mat-panel-description>
                </mat-expansion-panel-header>

                <div class="cinnamon-workstep-div"></div>

                The statistics give an overview of the configured metadata as well as basic metrics for each attribute.
                You can confirm, that the value distribution has not changed significantly after the import, especially if faulty rows were deleted or the holdout split was created.
                Statistics can also give you hints what attributes needs to be protected during the anonymization.

                <div class="mt-1">
                    <app-data-inspection [lazy]="true" sourceDataset="VALIDATION"></app-data-inspection>
                </div>

                <app-workstep [locked]="locked" [stepIndex]="1" [valid]="true"></app-workstep>
            </mat-expansion-panel>

            <mat-expansion-panel [disabled]="2 > currentStep" class="workstep-expansion-panel"
                                 [class.workstep-complete]="currentStep > 2 || stepsCompleted">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <app-workstep-title [stepIndex]="2">
                           Confirm the dataset and data configuration
                        </app-workstep-title>
                    </mat-panel-title>
                    <mat-panel-description>
                    </mat-panel-description>
                </mat-expansion-panel-header>

                <div class="cinnamon-workstep-div"></div>

                If you noticed any issues in the imported data or the statistics, you can go back to previous steps and change the dataset or the configuration.
                Otherwise you can continue with the current data, which will lock the import process.
                If you want to change anything prior to this point, you will have delete the dataset by clicking the "Delete Data" button on the bottom of this page.
                Be aware, that this will also delete all data and results of the following steps.

                <app-workstep [locked]="locked" [stepIndex]="2" [valid]="true"></app-workstep>
            </mat-expansion-panel>

        </mat-accordion>


        <div class="d-flex align-items-center justify-content-start mt-3 gap-3">
            <button mat-raised-button color="primary" (click)="confirmData()" [disabled]="locked || !stepsCompleted">
                Continue with the current dataset and data configuration
                <mat-icon>arrow_forward</mat-icon>
            </button>
            <button mat-raised-button color="warn" (click)="openDeleteDialog(deleteDialog)" [disabled]="!locked">
                <mat-icon>delete</mat-icon>
                Delete Data
            </button>
        </div>

    </ng-container>
    <ng-container *ngIf="status.mode === Mode.EXPERT">

        <div class="box mb-3">
            <table style="font-weight: bold;">
                <tr>
                    <td style="padding-right: 1rem;">Rows in the dataset:</td>
                    <td>{{ numberRows$ | async }}</td>
                </tr>
                <tr>
                    <td style="padding-right: 1rem;">Rows that will be adjusted:</td>
                    <td>{{ numberInvalidRows$ | async }}</td>
                </tr>
            </table>

            <div class="mt-2">
                By proceeding, you previous steps will be locked and can only be changed by deleting all date, including the results of the following steps.
            </div>

            <div class="d-flex align-items-center justify-content-start my-2">
                <button mat-raised-button color="primary" class="me-2" (click)="confirmData()" [disabled]="locked">
                    Continue
                    <mat-icon>arrow_forward</mat-icon>
                </button>
                <button mat-raised-button color="warn" (click)="openDeleteDialog(deleteDialog)" [disabled]="!locked">
                    <mat-icon>delete</mat-icon>
                    Delete Data
                </button>
            </div>

        </div>

        <mat-accordion multi>
            <mat-expansion-panel expanded class="workstep-expansion-panel">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <h5 style="margin-bottom: 0;">Data Upload Result</h5>
                    </mat-panel-title>
                    <mat-panel-description>
                    </mat-panel-description>
                </mat-expansion-panel-header>

                <ng-template matExpansionPanelContent>

                    <div class="cinnamon-workstep-div"></div>

                    Lines that are marked in red will be removed from your dataset, as they could not be transformed with your configuration.
                    The faulty column is marked in a deeper tone of red.
                    You can filter for valid and invalid rows in the table below.

                    <div class="mt-1">
                        <app-data-table sourceDataset="validation"></app-data-table>
                    </div>
                </ng-template>
            </mat-expansion-panel>
            <mat-expansion-panel expanded class="workstep-expansion-panel">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <h5 style="margin-bottom: 0;">Data Inspection</h5>
                    </mat-panel-title>
                    <mat-panel-description>
                    </mat-panel-description>
                </mat-expansion-panel-header>

                <ng-template matExpansionPanelContent>

                    <div class="cinnamon-workstep-div"></div>

                    <div class="mt-1">
                        <app-data-inspection [lazy]="true" sourceDataset="VALIDATION"></app-data-inspection>
                    </div>
                </ng-template>

            </mat-expansion-panel>
        </mat-accordion>

    </ng-container>
</ng-container>

<ng-template #info>

</ng-template>

<ng-template #deleteDialog>
    <mat-dialog-content class="mat-typography">
        <h1>Delete Data</h1>
        <div>
            Do you really want to delete the data.
            This will also delete the data and result of all following steps.
        </div>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
        <button mat-raised-button mat-dialog-close color="primary">Keep Data</button>
        <button mat-raised-button mat-dialog-close color="warn" (click)="deleteData()">Delete Data</button>
    </mat-dialog-actions>
</ng-template>
