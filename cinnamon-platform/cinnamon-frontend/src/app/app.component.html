<div class="main-wrapper">
    <app-loading-spinner></app-loading-spinner>

    <div class="content-left">
        <app-navigation></app-navigation>
    </div>

    <div class="content-right">
        <div class="title-wrapper">
            {{getTitle()}}
        </div>
        <div class="page-content">
            <!-- Info for locked step -->
            <ng-container *ngIf="{currentStep: currentStep$ | async, pipeline: pipeline$ | async} as data" >
                <ng-container *ngIf="data.currentStep != null && data.pipeline != null">
                    <div *ngIf="statusService.isStepCompleted(data.currentStep.lockedAfter) || data.pipeline.currentStageIndex != null"
                         style="position: sticky; top: 0; z-index: 10;">
                        <app-info-card typeClass="card-warn">
                            <div *ngIf="statusService.isStepCompleted(data.currentStep.lockedAfter)">
                                This step is locked because subsequent steps depend on it.
                                You have to reset the subsequent steps first before you can modify this step.
                            </div>
                            <div *ngIf="data.pipeline.currentStageIndex != null">
                                This step is locked because a Process is currently running.
                                You have to wait for it to finish or cancel the process before you can modify this step.
                            </div>
                            <div *ngIf="statusService.isStepCompleted(data.currentStep.lockedAfter)">
                                <button mat-raised-button color="primary"
                                        [disabled]="data.pipeline.currentStageIndex != null"
                                        (click)="stateManagementService.unlockStep(data.currentStep.enum)">
                                    Reset subsequent steps
                                </button>
                            </div>
                        </app-info-card>
                    </div>

                </ng-container>
            </ng-container>

            <!-- Error -->
            <ng-container *ngIf="errorList$ | async as errorList">
                <ng-container *ngFor="let error of errorList; let i = index">
                    <app-info-card typeClass="card-failure" [closable]="true" (onClose)="errorHandlingService.clearError(i)">
                        <div style="white-space: pre-line;">{{ error }}</div>
                    </app-info-card>
                </ng-container>
            </ng-container>

            <!-- Demo disclaimer -->
            <ng-container *ngIf="appConfig$ | async as appConfig">
                <app-info-card [hidden]="!appConfig.isDemoInstance" typeClass="card-warn">
                    This is a demo instance.
                    Please do not upload any real data!
                    Accounts will be deleted every day at 02:00 am.
                </app-info-card>
            </ng-container>

            <router-outlet></router-outlet>
        </div>
    </div>
</div>
